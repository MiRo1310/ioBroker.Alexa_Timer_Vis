{
  "version": 3,
  "sources": ["../../src/lib/start-timer.ts"],
  "sourcesContent": ["import { TimerSelector, timerObject, Timers } from \"./timer-data\";\nimport { Store, useStore } from \"../store/store\";\nimport { isString, timeToString } from \"./global\";\nimport { getInputDevice } from \"./get-input-device\";\nimport { interval } from \"./interval\";\nimport AlexaTimerVis from \"../main\";\nimport { registerIdToGetTimerName } from \"./timer-name\";\n\nexport const startTimer = async (sec: number, name: string, inputString: string): Promise<void> => {\n\tconst store = useStore();\n\tconst _this = store._this;\n\ttry {\n\t\tconst timerSelector = selectAvailableTimer(_this);\n\n\t\tawait getInputDevice(timerObject.timer[timerSelector as keyof typeof timerObject.timer]);\n\t\tawait registerIdToGetTimerName(timerSelector);\n\n\t\tconst jsonAlexa = await _this.getForeignStateAsync(`alexa2.0.History.json`);\n\t\tconst startTimer: number = getStartTimerValue(jsonAlexa);\n\n\t\tconst start_Time = timeToString(startTimer);\n\t\tconst timerMilliseconds = sec * 1000;\n\t\tconst endTimeMilliseconds = startTimer + timerMilliseconds;\n\t\tconst endTimeString = timeToString(endTimeMilliseconds);\n\n\t\tsaveToObject(timerSelector, endTimeMilliseconds, endTimeString, start_Time);\n\n\t\tawait setDeviceNameInStateName(timerSelector, _this, store);\n\n\t\tconst timer = timerObject.timer[timerSelector as keyof typeof timerObject.timer];\n\n\t\tif (isMoreThanAMinute(sec)) {\n\t\t\tinterval(sec, timerSelector, inputString, name, timer, store.intervalMore60 * 1000, false);\n\t\t\treturn;\n\t\t}\n\n\t\ttimerObject.timer.timer1.timerInterval = store.intervalLess60 * 1000;\n\n\t\tinterval(sec, timerSelector, inputString, name, timer, store.intervalLess60 * 1000, true);\n\t} catch (e: any) {\n\t\t_this.log.error(\"Error in startTimer: \" + JSON.stringify(e));\n\t\t_this.log.error(\"Error in startTimer: \" + JSON.stringify(e.stack));\n\t}\n};\n\nfunction getStartTimerValue(jsonAlexa: ioBroker.State | null | undefined): number {\n\tif (isString(jsonAlexa?.val)) {\n\t\treturn JSON.parse(jsonAlexa.val).creationTime;\n\t}\n\treturn new Date().getTime();\n}\n\nfunction selectAvailableTimer(_this: AlexaTimerVis): TimerSelector {\n\tfor (let i = 0; i < Object.keys(timerObject.timerActive.timer).length; i++) {\n\t\tconst key = Object.keys(timerObject.timerActive.timer)[i] as keyof typeof timerObject.timerActive.timer;\n\n\t\tif (timerObject.timerActive.timer[key] === false) {\n\t\t\ttimerObject.timerActive.timer[key] = true;\n\t\t\treturn key as keyof Timers;\n\t\t}\n\t}\n}\n\nasync function setDeviceNameInStateName(\n\ttimerBlock: string | undefined,\n\t_this: AlexaTimerVis,\n\tstore: Store,\n): Promise<void> {\n\tif (isString(timerBlock)) {\n\t\tawait _this.setObjectAsync(\"alexa-timer-vis.0.\" + timerBlock, {\n\t\t\ttype: \"device\",\n\t\t\tcommon: { name: `${store.deviceName}` },\n\t\t\tnative: {},\n\t\t});\n\t}\n}\n\nfunction isMoreThanAMinute(sec: number): boolean {\n\treturn sec > 60;\n}\n\nfunction saveToObject(\n\ttimerBlock: TimerSelector,\n\tendTimeNumber: number,\n\tendTimeString: string,\n\tstart_Time: string,\n): void {\n\tif (timerBlock) {\n\t\ttimerObject.timer[timerBlock].endTime = endTimeNumber;\n\t\ttimerObject.timer[timerBlock].end_Time = endTimeString;\n\t\ttimerObject.timer[timerBlock].start_Time = start_Time;\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAAmD;AACnD,mBAAgC;AAChC,oBAAuC;AACvC,8BAA+B;AAC/B,sBAAyB;AAEzB,wBAAyC;AAElC,MAAM,aAAa,OAAO,KAAa,MAAc,gBAAuC;AAClG,QAAM,YAAQ,uBAAS;AACvB,QAAM,QAAQ,MAAM;AACpB,MAAI;AACH,UAAM,gBAAgB,qBAAqB,KAAK;AAEhD,cAAM,wCAAe,8BAAY,MAAM,aAA+C,CAAC;AACvF,cAAM,4CAAyB,aAAa;AAE5C,UAAM,YAAY,MAAM,MAAM,qBAAqB,uBAAuB;AAC1E,UAAMA,cAAqB,mBAAmB,SAAS;AAEvD,UAAM,iBAAa,4BAAaA,WAAU;AAC1C,UAAM,oBAAoB,MAAM;AAChC,UAAM,sBAAsBA,cAAa;AACzC,UAAM,oBAAgB,4BAAa,mBAAmB;AAEtD,iBAAa,eAAe,qBAAqB,eAAe,UAAU;AAE1E,UAAM,yBAAyB,eAAe,OAAO,KAAK;AAE1D,UAAM,QAAQ,8BAAY,MAAM,aAA+C;AAE/E,QAAI,kBAAkB,GAAG,GAAG;AAC3B,oCAAS,KAAK,eAAe,aAAa,MAAM,OAAO,MAAM,iBAAiB,KAAM,KAAK;AACzF;AAAA,IACD;AAEA,kCAAY,MAAM,OAAO,gBAAgB,MAAM,iBAAiB;AAEhE,kCAAS,KAAK,eAAe,aAAa,MAAM,OAAO,MAAM,iBAAiB,KAAM,IAAI;AAAA,EACzF,SAAS,GAAQ;AAChB,UAAM,IAAI,MAAM,0BAA0B,KAAK,UAAU,CAAC,CAAC;AAC3D,UAAM,IAAI,MAAM,0BAA0B,KAAK,UAAU,EAAE,KAAK,CAAC;AAAA,EAClE;AACD;AAEA,SAAS,mBAAmB,WAAsD;AACjF,UAAI,wBAAS,uCAAW,GAAG,GAAG;AAC7B,WAAO,KAAK,MAAM,UAAU,GAAG,EAAE;AAAA,EAClC;AACA,UAAO,oBAAI,KAAK,GAAE,QAAQ;AAC3B;AAEA,SAAS,qBAAqB,OAAqC;AAClE,WAAS,IAAI,GAAG,IAAI,OAAO,KAAK,8BAAY,YAAY,KAAK,EAAE,QAAQ,KAAK;AAC3E,UAAM,MAAM,OAAO,KAAK,8BAAY,YAAY,KAAK,EAAE,CAAC;AAExD,QAAI,8BAAY,YAAY,MAAM,GAAG,MAAM,OAAO;AACjD,oCAAY,YAAY,MAAM,GAAG,IAAI;AACrC,aAAO;AAAA,IACR;AAAA,EACD;AACD;AAEA,eAAe,yBACd,YACA,OACA,OACgB;AAChB,UAAI,wBAAS,UAAU,GAAG;AACzB,UAAM,MAAM,eAAe,uBAAuB,YAAY;AAAA,MAC7D,MAAM;AAAA,MACN,QAAQ,EAAE,MAAM,GAAG,MAAM,UAAU,GAAG;AAAA,MACtC,QAAQ,CAAC;AAAA,IACV,CAAC;AAAA,EACF;AACD;AAEA,SAAS,kBAAkB,KAAsB;AAChD,SAAO,MAAM;AACd;AAEA,SAAS,aACR,YACA,eACA,eACA,YACO;AACP,MAAI,YAAY;AACf,kCAAY,MAAM,UAAU,EAAE,UAAU;AACxC,kCAAY,MAAM,UAAU,EAAE,WAAW;AACzC,kCAAY,MAAM,UAAU,EAAE,aAAa;AAAA,EAC5C;AACD;",
  "names": ["startTimer"]
}
